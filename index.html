<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <link rel="icon" href="logo.svg" type="image/svg+xml">
  <title>Калькулятор коробки</title>
  <style>
    body {
  font-family: 'Segoe UI', sans-serif;
  background: #f4f5f7;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 24px;
  min-height: 100vh;
  margin: 0;
}

.container {
  background: #ffffff;
  padding: 24px 28px;
  border-radius: 14px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  max-width: 480px;
  width: 100%;
  box-sizing: border-box;
}

h2 {
  text-align: center;
  margin-bottom: 18px;
  font-size: 20px;
  color: #2d2f35;
}

label {
  display: block;
  margin-top: 14px;
  font-size: 0.95rem;
  font-weight: 600;
  color: #444;
}

input, select {
  width: 100%;
  padding: 10px 12px;
  margin-top: 6px;
  border: 1.5px solid #ddd;
  border-radius: 8px;
  background: #fafafa;
  font-size: 0.95rem;
  box-sizing: border-box;
}

button {
  width: 100%;
  margin-top: 24px;
  padding: 12px;
  background-color: #1cc069;
  border: 1px solid;
  color: #fff;
  font-weight: 600;
  font-size: 1rem;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.2s ease;
}

button:hover {
  background: linear-gradient(360deg, #00ad51);
   background-color: #32c156;
  color: white;
  
}

table {
  width: 100%;
  margin-top: 18px;
  border-collapse: collapse;
  text-align: center;
  font-size: 0.95rem;
}

th, td {
  padding: 10px 6px;
  border-bottom: 1px solid #e0e0e0;
}

th {
  color: #555;
  font-weight: 600;
  background-color: #1cc06921;
}

td {
  background-color: #fff;
  font-weight: 600;
  color: #333;
}

.price-cell.active {
  background-color: #1cc06921 !important;
  color: #2b995f;
  font-weight: 800;
  border-radius: 6px;
}

#discount-hint {
  margin-top: 14px;
  text-align: center;
  font-size: 0.92rem;
  color: #333;
  font-weight: 600;
}

.highlight-number {
  background-color: #1cc06921;
  color: #2b995f;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 6px;
  display: inline-block;
  margin: 0 3px;
}

.info {
  margin-top: 18px;
  font-size: 0.9rem;
  color: #666;
  line-height: 1.4;
}

/* Цены - вспышка при пересчете */
@keyframes flashUpdate {
  0%   { background-color: #ffeebd; }
  100% { background-color: #f4f7ff; }
}

.price-cell.updated {
  animation: flashUpdate 0.6s ease;
}

/* Плавное появление блока информации */
.info {
  opacity: 0;
  transform: translateY(15px);
  transition: opacity 0.5s ease, transform 0.5s ease;
}

.info.visible {
  opacity: 1;
  transform: translateY(0);
}


.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.4);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999;
  transition: opacity 0.3s ease;
}

.modal.hidden {
  opacity: 0;
  pointer-events: none;
}

.modal-content {
  background-color: white;
  padding: 24px 28px;
  border-radius: 12px;
  box-shadow: 0 6px 24px rgba(0,0,0,0.2);
  text-align: center;
  max-width: 400px;
  width: 100%;
}

.modal-content p {
  margin-bottom: 20px;
  font-size: 1rem;
  color: #333;
  font-weight: 600;
}

.modal-content button {
  padding: 10px 20px;
  background-color: #1cc069;
  color: #fff;
  border: 1px solid;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: background-color 0.2s ease;
}

.modal-content button:hover {
  background-color: #1cc069;
   color: white;
}

  </style>
</head>
<body>
  <div class="container">
    <h2>Калькулятор стоимости коробки из гофрокартона</h2>

    <label>Длина (мм):</label>
    <input type="number" id="length" />

    <label>Ширина (мм):</label>
    <input type="number" id="width" />

    <label>Высота (мм):</label>
    <input type="number" id="height" />

    <label>Количество коробок:</label>
    <input type="number" id="quantity" value="1" min="1" />

    <label>Марка картона:</label>
    <select id="grade"></select>

    <button class="glow-button" onclick="calculate()">Рассчитать</button>

    <h3 style="text-align: center; color: #444;">Цена за коробку:</h3>
    <table>
      <tr>
        <th>Мелкая Розница</th>
        <th>Розница до 2000 м²</th>
        <th>Опт. от 2000 м²</th>
        <th>Спец. от 3000 м²</th>
      </tr>
      <tr>
        <td id="retail1" class="price-cell">–</td>
        <td id="retail2" class="price-cell">–</td>
        <td id="wholesale" class="price-cell">–</td>
        <td id="special" class="price-cell">–</td>
      </tr>
    </table>
	<div id="discount-hint" style="margin-top: 12px; text-align: center; font-weight: 600; color: #3a3f58;"></div>

    <div id="info" class="info"></div>
	
	<div id="modal" class="modal hidden">
  <div class="modal-content">
    <p id="modal-message">Ошибка</p>
    <button onclick="closeModal()">ОК</button>
  </div>
</div>
  </div>

  <script>
    const prices = {
      "Т-23С Бурый": { retail1: 702.83, retail2: 284.17, wholesale: 244.98, special: 234.28 },
      "Т-23В Бурый": { retail1: 689.64, retail2: 278.84, wholesale: 240.38, special: 229.88 },
	  "Т-23В Белый": { retail1: 834.82, retail2: 337.53, wholesale: 290.97, special: 278.27 },
	  "Т-23Е Бурый": { retail1: 679.73, retail2: 274.84, wholesale: 236.93, special: 226.58 },
	  "Т-23Е Белый": { retail1: 801.81, retail2: 324.19, wholesale: 279.47, special: 267.27 },
      "Т-24С Бурый": { retail1: 735.84, retail2: 297.52, wholesale: 256.48, special: 245.28 },
      "Т-24В Бурый": { retail1: 725.93, retail2: 293.51, wholesale: 253.03, special: 241.98 },
      "Т-24В Белый": { retail1: 874.44, retail2: 353.54, wholesale: 304.78, special: 291.48 },
      "Т-25С Бурый": { retail1: 768.81, retail2: 310.84, wholesale: 267.97, special: 256.27 },
      "Т-25В Бурый": { retail1: 762.23, retail2: 308.18, wholesale: 265.68, special: 254.08 },
	  "Т-25С Белый": { retail1: 917.31, retail2: 370.88, wholesale: 319.72, special: 305.77 },
	  "Т-25В Белый": { retail1: 881.02, retail2: 356.20, wholesale: 307.07, special: 293.67 },
	  "Т-25С Бурый целлюлоза 1 слой": { retail1: 920.64, retail2: 372.22, wholesale: 320.88, special: 306.88 },
	  "Т-25С Бурый целлюлоза 2 слой": { retail1: 973.42, retail2: 393.56, wholesale: 339.27, special: 324.47 },
      "Т-26С Бурый": { retail1: 883.94, retail2: 357.38, wholesale: 308.09, special: 294.65 },
	  "Т-26С Бурый целлюлоза 1 слой": { retail1: 966.84, retail2: 390.90, wholesale: 336.98, special: 322.28 },
	  "Т-26С Бурый целлюлоза 2 слой": { retail1: 1052.62, retail2: 425.57, wholesale: 366.87, special: 350.87 },
	  "Т-26В Бурый целлюлоза 1 слой": { retail1: 933.83, retail2: 377.55, wholesale: 325.48, special: 311.28 },
	  "Т-26В Бурый целлюлоза 2 слой": { retail1: 1039.43, retail2: 420.24, wholesale: 362.28, special: 346.48 },
      "Т-27С Бурый": { retail1: 960.22, retail2: 388.22, wholesale: 334.67, special: 320.07 },
	  "Т-27С Бурый целлюлоза 1 слой": { retail1: 1042.72, retail2: 421.57, wholesale: 363.42, special: 347.57 },
	  "Т-27С Бурый целлюлоза 2 слой": { retail1: 1128.54, retail2: 456.26, wholesale: 393.33, special: 376.18 }
    };

    const gradeSelect = document.getElementById('grade');
    Object.keys(prices).forEach(key => {
      const option = document.createElement('option');
      option.value = key;
      option.textContent = key;
      gradeSelect.appendChild(option);
    });

function animateNumber(el, start, end, duration = 300) {
  const range = end - start;
  const startTime = performance.now();

  function step(currentTime) {
    const progress = Math.min((currentTime - startTime) / duration, 1);
    const current = start + range * progress;
    el.textContent = current.toFixed(2) + ' ₸';
    if (progress < 1) {
      requestAnimationFrame(step);
    }
  }

  requestAnimationFrame(step);
}

    function calculate() {
  const L = +document.getElementById('length').value;
  const W = +document.getElementById('width').value;
  const H = +document.getElementById('height').value;
  const qty = +document.getElementById('quantity').value;
  const grade = document.getElementById('grade').value;

  if (!L || !W || !H || !qty || qty <= 0) {
  showModal("Пожалуйста, введите корректные данные для всех полей.");
  return;
}

  function customRound(value) {
  const base = Math.floor(value / 10) * 10;
  const remainder = value % 10;
  if (remainder < 3) return base + 10;
  else if (remainder < 7) return base + 15;
  else return base + 20;
}

const thickness = 4;
const glueFlap = 40;
const extra = 12;
const extra2 = 4;
const extra3 = 2;

const rawSheetHeight = H + extra2 + (Math.floor(W / 2) + extra3) * 2;
const sheetHeight = Math.floor(rawSheetHeight);

const rawSheetWidth = 2 * L + 2 * W + glueFlap + extra;
const sheetWidth = customRound(rawSheetWidth);

let area;
if (rawSheetWidth >= 2088) {
  area = (((W + L + glueFlap + 6) * sheetHeight) * 2) / 1_000_000;
} else {
  area = (sheetHeight * sheetWidth) / 1_000_000;
}
  const totalArea = area * qty;

  let tier = '';
  if (totalArea >= 3000) tier = 'special';
  else if (totalArea >= 2000) tier = 'wholesale';
  else if (area >= 0.3) tier = 'retail2';
  else tier = 'retail1';

  const selectedPrices = prices[grade];

  document.querySelectorAll('.price-cell').forEach(td => {
  td.classList.remove('active', 'updated');
});

const cells = {
  retail1: area * selectedPrices.retail1,
  retail2: area * selectedPrices.retail2,
  wholesale: area * selectedPrices.wholesale,
  special: area * selectedPrices.special
};

for (const id in cells) {
  const el = document.getElementById(id);
  const oldValue = parseFloat(el.textContent) || 0;
  animateNumber(el, oldValue, cells[id]);
}

['retail1', 'retail2', 'wholesale', 'special'].forEach(id => {
  document.getElementById(id).classList.add('updated'); // анимация
});

document.getElementById(tier).classList.add('active');

  // Расчёт "сколько добрать"
  let nextTier = '';
  let nextThreshold = 0;

  if (tier === 'retail1' && area >= 0.3) {
    nextTier = 'retail2';
    nextThreshold = 0.3;
  } else if (tier === 'retail1' || tier === 'retail2') {
    nextTier = 'wholesale';
    nextThreshold = 2000;
  } else if (tier === 'wholesale') {
    nextTier = 'special';
    nextThreshold = 3000;
  }

  let suggestionText = '';
if (nextTier && nextThreshold) {
  if (nextTier === 'retail2') {
    suggestionText = `Ваша коробка уже превышает 0.3 м² — применяется цена "${nextTier}".`;
  } else {
    const remainingArea = nextThreshold - totalArea;
    const extraBoxes = Math.ceil(remainingArea / area);
    if (extraBoxes > 0) {
      const tierNames = {
  retail2: 'Розничную цену',
  wholesale: 'Оптовую цену',
  special: 'Спец. цену'
};

suggestionText = `Добавьте ещё <span class="highlight-number">${extraBoxes}</span> коробок, чтобы получить <strong>${tierNames[nextTier]}</strong>.`;

    }
  }
}

const areaEl = document.getElementById('areaValue');
const totalEl = document.getElementById('totalAreaValue');

if (areaEl && totalEl) {
  const oldArea = parseFloat(areaEl.textContent) || 0;
  const oldTotal = parseFloat(totalEl.textContent) || 0;

  animateNumber(areaEl, oldArea, area, 500);
  animateNumber(totalEl, oldTotal, totalArea, 500);
}

// Вывод текста под таблицей
document.getElementById('discount-hint').innerHTML = suggestionText;
document.getElementById('info').innerHTML = `
  <div><strong>Заготовка:</strong> ${sheetWidth} × ${sheetHeight} мм</div>
  <div><strong>Площадь 1 коробки:</strong> <span id="areaValue">${area.toFixed(3)}</span> м²</div>
  <div><strong>Общая площадь:</strong> <span id="totalAreaValue">${totalArea.toFixed(2)}</span> м²</div>
`;

const infoBlock = document.getElementById('info');
infoBlock.innerHTML = `
  <strong>Заготовка:</strong> ${sheetWidth} × ${sheetHeight} мм<br>
  <strong>Площадь 1 коробки:</strong> ${area.toFixed(3)} м²<br>
  <strong>Общая площадь:</strong> ${totalArea.toFixed(2)} м²
`;

// Добавить анимацию появления
infoBlock.classList.remove('visible'); // на случай повторного расчета
setTimeout(() => infoBlock.classList.add('visible'), 50);
}

function showModal(message) {
  const modal = document.getElementById("modal");
  const messageEl = document.getElementById("modal-message");
  messageEl.textContent = message;
  modal.classList.remove("hidden");

  // Автоматически закрыть через 5 секунд (можно убрать)
  setTimeout(() => {
    closeModal();
  }, 5000);
}

function closeModal() {
  const modal = document.getElementById("modal");
  modal.classList.add("hidden");
}
  </script>
</body>
</html>
